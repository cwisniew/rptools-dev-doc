"use strict";(self.webpackChunkmaptool_dev_doc=self.webpackChunkmaptool_dev_doc||[]).push([[790],{46490:function(e,t,a){a.r(t),a.d(t,{frontMatter:function(){return s},contentTitle:function(){return r},metadata:function(){return c},assets:function(){return p},toc:function(){return m},default:function(){return d}});var n=a(87462),l=a(63366),i=(a(67294),a(3905)),o=["components"],s={slug:"lib-token-uri",title:"Lib:Tokens URI access",authors:["craigw"],tags:["MapTool","lib:tokens","MapTool 1.10"]},r=void 0,c={permalink:"/blog/lib-token-uri",editUrl:"https://github.com/cwisniew/rptools-dev-doc/edit/main/blog/2021-10-02-lib-token-uri/index.mdx",source:"@site/blog/2021-10-02-lib-token-uri/index.mdx",title:"Lib:Tokens URI access",description:"Issues with HTML/CSS/JavaScript Prior to MapTool 1.10",date:"2021-10-02T00:00:00.000Z",formattedDate:"October 2, 2021",tags:[{label:"MapTool",permalink:"/blog/tags/map-tool"},{label:"lib:tokens",permalink:"/blog/tags/lib-tokens"},{label:"MapTool 1.10",permalink:"/blog/tags/map-tool-1-10"}],readingTime:3.645,truncated:!1,authors:[{name:"Craig Wisniewski",title:"MapTool Architect / Lead Developer",url:"https://github.com/cwisniew",key:"craigw"}],nextItem:{title:"Player Databases",permalink:"/blog/player-databases"}},p={authorsImageUrls:[void 0]},m=[{value:"Issues with HTML/CSS/JavaScript Prior to MapTool 1.10",id:"issues-with-htmlcssjavascript-prior-to-maptool-110",children:[]},{value:"Changes in MapTool 1.10",id:"changes-in-maptool-110",children:[{value:"Allowing URI access",id:"allowing-uri-access",children:[]},{value:"Macro functions",id:"macro-functions",children:[]},{value:"Uses for lib:// URIs",id:"uses-for-lib-uris",children:[]}]}],u={toc:m};function d(e){var t=e.components,s=(0,l.Z)(e,o);return(0,i.kt)("wrapper",(0,n.Z)({},u,s,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"issues-with-htmlcssjavascript-prior-to-maptool-110"},"Issues with HTML/CSS/JavaScript Prior to MapTool 1.10"),(0,i.kt)("p",null,"Prior to MapTool 1.10 creating HTML pages is unnecessary cumbersome.\nTo create HTML dialogs, frames, and overlays you use the following roll options."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"[frame(): { } ]")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"[frame5(): { } ]")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"[dialog(): { } ]")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"[dialog5(): { } ]")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"[overlay(): { } ]"))),(0,i.kt)("p",null,"The HTML is included in the ",(0,i.kt)("inlineCode",{parentName:"p"},"[ ]")," which means it has to processed by the MTScript parser. This has both benefits and drawbacks.\nThe main benefit is that you can use ",(0,i.kt)("inlineCode",{parentName:"p"},"[ ]")," to execute MTScript elements as a form of templating the HTML, for example"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'[frame("test): {\n    [r: getName() ]\n}]\n')),(0,i.kt)("p",null,"The major drawback is that everything included must be able to pass through the MTScript parser, often this will not be the case especially where CSS or JavaScript are concerned.\nYou can work around this problem by using macros functions to fetch text from macro, for example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'[frame5("test"): {\n    [r: getMacroCommand(number(getMacroIndexes("test/test.html"))) ]\n}]\n')),(0,i.kt)("h2",{id:"changes-in-maptool-110"},"Changes in MapTool 1.10"),(0,i.kt)("p",null,"In MapTool 1.10 there is a change that allows you to access properties and macros on Lib:Tokens via a URI of the form"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"lib://",(0,i.kt)("em",{parentName:"li"},"<","token name",">"),"/macro/",(0,i.kt)("em",{parentName:"li"},"<","macro name",">")),(0,i.kt)("li",{parentName:"ul"},"lib://",(0,i.kt)("em",{parentName:"li"},"<","token name",">"),"/property/",(0,i.kt)("em",{parentName:"li"},"<","property name",">"))),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"By default the text fetched using the URI is cached, if you make changes to the content it will not be reflected until you restart MapTool. To work around this you can add the ",(0,i.kt)("inlineCode",{parentName:"p"},"cachelib=false")," query string as show in examples later on in this post."))),(0,i.kt)("p",null,"Where ",(0,i.kt)("em",{parentName:"p"},"<","token name",">")," is the name of the Lib:Token after the Lib: prefix, for example Lib:HTMLTest would be HTMLTest"),(0,i.kt)("h3",{id:"allowing-uri-access"},"Allowing URI access"),(0,i.kt)("p",null,'There are no special requirements on ownership for the Lib:Token, to allow URI access to Lib:Token properties and macros, anyone will be able to access these values via a URI if the "Allow URI Access" flag needs is set, you can do this via the edit token dialog.\n',(0,i.kt)("img",{alt:"Allow URI access",src:a(4774).Z})),(0,i.kt)("p",null,"or the ",(0,i.kt)("inlineCode",{parentName:"p"},"setAllowsURIAccess()")," macro function."),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"Reserved names")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("details",null,(0,i.kt)("summary",null,'Some names are reserved for future internal usage and you will not be able set the "Allows URI Access" flags on Lib:Tokens'," "),(0,i.kt)("div",null,"Reserved names are: Lib tokens with the following names (after the lib: part)",(0,i.kt)("ul",null,(0,i.kt)("li",null," rptools "),(0,i.kt)("li",null," maptool "),(0,i.kt)("li",null," maptools (because people often call it maptools) "),(0,i.kt)("li",null," internal "),(0,i.kt)("li",null," builtin "),(0,i.kt)("li",null," standard ")),"Lib tokens starting with the following names (after the lib: part)",(0,i.kt)("ul",null,(0,i.kt)("li",null," rptools. "),(0,i.kt)("li",null," maptool. "),(0,i.kt)("li",null," maptools. (because people often call it maptools) "),(0,i.kt)("li",null," tokentool. "),(0,i.kt)("li",null," net.rptools. "),(0,i.kt)("li",null," internal. "),(0,i.kt)("li",null," _ "),(0,i.kt)("li",null," builtin. "),(0,i.kt)("li",null," standard. "),(0,i.kt)("li",null," . ")))))),(0,i.kt)("h3",{id:"macro-functions"},"Macro functions"),(0,i.kt)("p",null,'Two new MTScript functions have been added that allow you to set or get the "Allows URI access" flag for a token. These can only be run from a trusted macro.'),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"getAllowsURIAccess([<token name>], [<map name>])")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"setAllowsURIAccess(<0|1>, [<token name>, [<map name>])"))),(0,i.kt)("h3",{id:"uses-for-lib-uris"},"Uses for lib:// URIs"),(0,i.kt)("p",null,"Lib:// URIs are useful for both CSS and JavaScript inclusion in HTML files, creating frames/dialogs/overlays with HTML, and the ",(0,i.kt)("inlineCode",{parentName:"p"},"js.evalURI()")," MTScript functions."),(0,i.kt)("h4",{id:"including-javascript-and-css-in-html-using-a-lib-uri"},"Including JavaScript and CSS in HTML using a lib:// URI"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-html"},'<html>\n  <head>\n    <link\n      rel="stylesheet"\n      href="lib://HTMLTest/macro/test/test.css?cachelib=false"\n    />\n  </head>\n  <body>\n    <h1>This is a test</h1>\n    <div id="test1" />\n    <script src="lib://HTMLTest/macro/test/test.js?cachelib=false"><\/script>\n    <img src="asset://87f4e9bfa4f1f3db250b57b3599fa4e9" />\n  </body>\n</html>\n')),(0,i.kt)("p",null,"This will include CSS from the macro called test/test.css and the JavaScript from a macro called test/test.js on the Lib:HTMLTest token."),(0,i.kt)("h4",{id:"creating-framesdialogsoverlays-using-a-lib-uri"},"Creating frames/dialogs/overlays using a lib:// URI"),(0,i.kt)("p",null,"There are also new MTScript functions that allow you to create frames/dialogs/overlays by passing a lib:// URI which contains the HTML.\nThese are"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"html.dialog(<dialog name>, <libURI>, [<options>])")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"html.dialog5(<dialog name>, <libURI>, [<options>])")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"html.frame(<frame name>, <libURI>, [<options>])")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"html.frame5(<frame name>, <libURI>, [<options>])")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"html.overlay(<overlay name>, <libURI>, [<options>])"))),(0,i.kt)("p",null,'The optional "options" argument contains the same arguments and format as the frame/dialog/overlay ',(0,i.kt)("a",{parentName:"p",href:"https://wiki.rptools.info/index.php/frame5_%28roll_option%29"},"roll options")),(0,i.kt)("h4",{id:"running-javascript-from-a-lib-uri"},"Running JavaScript from a lib:// URI"),(0,i.kt)("p",null,"In addition to being able to include JavaScript in HTML via the ",(0,i.kt)("inlineCode",{parentName:"p"},"<script>")," tag, lib:// URIs can be used to execute JavaScript via the ",(0,i.kt)("inlineCode",{parentName:"p"},"js.evalUI()"),"macro function."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"js.evalURI(<namespace>, <libURI>, [arg1, ... argN])"))),(0,i.kt)("p",null,"Where"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"<","namespace",">")," is the namespace of the JavaScript context to run the script in."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"<","libURI",">")," is the lib:// URI to fetch the JavasScript from."),(0,i.kt)("li",{parentName:"ul"},"[arg1, ... argN]"," is a comma-separated list of arguments to be passed to the script")))}d.isMDXComponent=!0},4774:function(e,t,a){t.Z=a.p+"assets/images/allow-uri-access-1372842f2232a8148e58124a73a4d872.png"}}]);